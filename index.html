<!DOCTYPE html>
<html lang="ml">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Report</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3f51b5">

    <!-- Google Fonts: Roboto -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #3f51b5;
            --primary-dark: #303f9f;
            --bg-color: #f5f5f6;
            --surface-color: #ffffff;
            --text-primary: rgba(0, 0, 0, 0.87);
            --text-secondary: rgba(0, 0, 0, 0.6);
            --border-color: rgba(0, 0, 0, 0.12);
            --shadow-1: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            --shadow-2: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
            --radius-md: 8px;
            --radius-sm: 4px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.5;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h2 {
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 24px;
            color: var(--primary);
            text-align: center;
        }

        h3 {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 16px;
            color: var(--text-primary);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 8px;
            display: inline-block;
        }

        h4 {
            font-size: 16px;
            font-weight: 500;
            margin-top: 16px;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .section {
            background: var(--surface-color);
            padding: 24px;
            margin-bottom: 24px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-1);
            transition: box-shadow 0.3s cubic-bezier(.25, .8, .25, 1);
        }

        .section:hover {
            box-shadow: var(--shadow-2);
        }

        label {
            display: block;
            margin-top: 16px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        textarea,
        input:not([type="radio"]):not([type="checkbox"]) {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            font-family: inherit;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            background-color: #fafafa;
            transition: border-color 0.2s, box-shadow 0.2s;
            outline: none;
        }

        input:focus,
        textarea:focus {
            border-color: var(--primary);
            box-shadow: inset 0 0 0 1px var(--primary);
            background-color: #fff;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Material Buttons */
        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 24px;
            margin-bottom: 30px;
        }

        button {
            font-family: 'Roboto', sans-serif;
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            box-shadow: var(--shadow-1);
            transition: background-color 0.2s, box-shadow 0.2s, transform 0.1s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        button:hover {
            background-color: var(--primary-dark);
            box-shadow: var(--shadow-2);
        }

        button:active {
            box-shadow: var(--shadow-1);
            transform: translateY(1px);
        }

        button:disabled {
            background-color: #bdbdbd;
            box-shadow: none;
            cursor: not-allowed;
            color: rgba(0, 0, 0, 0.26);
        }

        /* Add more button style overrides */
        button[onclick^="addBayah"] {
            background-color: transparent;
            color: var(--primary);
            box-shadow: none;
            border: 1px solid var(--primary);
            margin-top: 8px;
        }

        button[onclick^="addBayah"]:hover {
            background-color: rgba(63, 81, 181, 0.08);
            box-shadow: none;
        }

        button[onclick*="remove"] {
            background-color: #f44336;
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
            box-shadow: none;
        }

        button[onclick*="remove"]:hover {
            background-color: #d32f2f;
        }

        /* Radio Buttons */
        input[type="radio"] {
            accent-color: var(--primary);
            width: 16px;
            height: 16px;
            margin-right: 6px;
            vertical-align: text-bottom;
        }

        .radio-group label {
            display: inline-flex;
            align-items: center;
            margin-top: 0;
            margin-right: 20px;
            font-size: 15px;
            cursor: pointer;
            color: var(--text-primary);
        }

        pre {
            white-space: pre-wrap;
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 14px;
            line-height: 1.6;
            margin-top: 20px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15);
            overflow-x: auto;
        }

        p {
            color: var(--text-secondary);
            font-size: 15px;
            margin-bottom: 8px;
        }

        .bayah-entry {
            background: #fff !important;
            border: 1px solid var(--border-color) !important;
            border-radius: var(--radius-sm);
            padding: 16px !important;
            margin-bottom: 16px !important;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            position: relative;
        }
    </style>
</head>

<body>

    <div class="container">
        <h2>Report</h2>

        <label>തീയതി</label>
        <input type="date" id="date">

        <p><b>സ്ഥലം:</b> ദാറുൽ കിറാം കാഞ്ഞങ്ങാട്</p>

        <datalist id="nameList">
            <option value="മുഹ്സിൻ കാഞ്ഞങ്ങാട്">
            <option value="മുബാറക്ക് കാഞ്ഞങ്ങാട്">
            <option value="നിസാർ കാഞ്ഞങ്ങാട്">
            <option value="റിയാസ് കാഞ്ഞങ്ങാട്">
            <option value="സഫ്‌വാൻ കാഞ്ഞങ്ങാട്">
            <option value="അൻസൽ കാഞ്ഞങ്ങാട്">
            <option value="ശാഹിദ് കാഞ്ഞങ്ങാട്">
            <option value="അഷ്റഫ് കാഞ്ഞങ്ങാട്">
            <option value="സത്താർ കാഞ്ഞങ്ങാട്">
        </datalist>

        <div class="section">
            <h3>ഇമാം / നേതൃത്വം</h3>

            <label>മഗ്രിബ് ഇമാം</label>
            <input list="nameList" id="maghrib">

            <label>നേതൃത്വം</label>
            <input list="nameList" id="family">

            <label>ദർസ് നടത്തുന്നവർ</label>
            <input list="nameList" id="dars">

            <label>ദർസ് അവലംബം</label>
            <input id="darsRef">
        </div>

        <div class="section">
            <h3>ഖുർആൻ & ഖസീദ</h3>

            <label>ഖുർആൻ പേജ് നമ്പർ</label>
            <input id="surahPage">

            <label>ആയത്ത് നമ്പർ</label>
            <input id="ayah">

            <label>ഖസീദ പേജ് നമ്പർ</label>
            <input id="qPage">

            <label>ബൈത് നമ്പർ</label>
            <input id="baith">
        </div>

        <div class="section">
            <h3>മുറാഖബ</h3>

            <label>നേതൃത്വം</label>
            <input list="nameList" id="muraqaba">
        </div>

        <div class="section">
            <h3>ഹള്റ</h3>

            <div class="radio-group" style="margin-bottom: 15px;">
                <label><input type="radio" name="hadraType" value="full" checked> Full Hadra</label>
                <label><input type="radio" name="hadraType" value="short"> Short Hadra</label>
            </div>

            <label>മുസ്തഫ്തിഹ്</label>
            <input list="nameList" id="mustafthih">

            <label>ബുസ്ത് 1 (main)</label>
            <input list="nameList" id="bust1Main">

            <label>ബുസ്ത് 1 (പങ്കെടുക്കുന്നവർ)</label>
            <textarea id="bust1List" placeholder="ഓരോ പേരും ഓരോ വരിയിൽ"></textarea>

            <div id="madadSection">
                <label>മദദ്</label>
                <input list="nameList" id="madad">
            </div>

            <label>ഖസീദ 1</label>
            <input list="nameList" id="q1">

            <label>ഖസീദ 2</label>
            <input list="nameList" id="q2">

            <label>ഫർദാനി</label>
            <input list="nameList" id="fardani">

            <label>ബുസ്ത് 2 (main)</label>
            <input list="nameList" id="bust2Main">

            <label>ബുസ്ത് 2 (പങ്കെടുക്കുന്നവർ)</label>
            <textarea id="bust2List" placeholder="ഓരോ പേരും ഓരോ വരിയിൽ"></textarea>

            <label>ഖസീദ 3</label>
            <input list="nameList" id="q3">

            <label>ഖസീദ 4</label>
            <input list="nameList" id="q4">

            <label>ഫവാത്തിഹ് & ദുആ</label>
            <input list="nameList" id="dua">
        </div>

        <div class="section">
            <h3>മുൻഷിദീങ്ങൾ</h3>
            <textarea id="munshideen" placeholder="ഓരോ പേരും ഓരോ വരിയിൽ"></textarea>
        </div>

        <div class="section">
            <h3>നമസ്‌കാരം</h3>

            <label>ഇഷാ ഇമാം</label>
            <input list="nameList" id="isha">

            <label>തറാവീഹ് ഇമാമ്മാർ</label>
            <textarea id="tarawih" placeholder="ഓരോ പേരും ഓരോ വരിയിൽ"></textarea>
        </div>

        <div class="section">
            <h3>പങ്കെടുത്ത മജ്ലിസുൽ ഉമന അംഗങ്ങൾ</h3>
            <textarea id="umana" placeholder="ഓരോ പേരും ഓരോ വരിയിൽ"></textarea>
        </div>

        <div class="section">
            <h3>● നഫഹ</h3>
            <textarea id="nafah" placeholder="ഓരോ പേരും ഓരോ വരിയിൽ"></textarea>
        </div>

        <div class="section">
            <h3>പുതിയ ബൈഅത്ത്</h3>

            <h4>റിജാൽ</h4>
            <div id="bayahContainer">
                <div class="bayah-entry"
                    style="margin-bottom: 15px; padding: 10px; background: #f9f9f9; border: 1px solid #ddd;">
                    <label>പേര്</label>
                    <input class="bayahName">

                    <label>മുർഷിദ്</label>
                    <input list="nameList" class="bayahMurshid">
                </div>
            </div>
            <button type="button" onclick="addBayahEntry('bayahContainer')"
                style="padding: 5px 10px; font-size: 14px; margin-top: 5px;">+ Add More (റിജാൽ)</button>

            <h4 style="margin-top:20px;">സയ്യിദാത്ത്</h4>
            <div id="bayahSContainer">
                <div class="bayah-entry"
                    style="margin-bottom: 15px; padding: 10px; background: #f9f9f9; border: 1px solid #ddd;">
                    <label>സയ്യിദാത്ത് പേര് </label>
                    <input class="bayahSName">

                    <label>സയ്യിദാത്ത് മുർഷിദ് </label>
                    <input list="nameList" class="bayahSMurshid">
                </div>
            </div>
            <button type="button" onclick="addBayahEntry('bayahSContainer', true)"
                style="padding: 5px 10px; font-size: 14px; margin-top: 5px;">+ Add More (സയ്യിദാത്ത്)</button>
        </div>

        <div class="section">
            <h3>പങ്കെടുത്തവർ</h3>

            <label>പുരുഷന്മാർ</label>
            <input type="number" id="men">

            <label>സയ്യിദാത്ത്</label>
            <input type="number" id="sayyidath">

            <label>കുട്ടികൾ</label>
            <input type="number" id="children">
        </div>

        <div class="section">
            <h3>റിപ്പോർട്ട്</h3>

            <label>Report prepared by</label>
            <input list="nameList" id="preparedBy">

            <label>Report verified by</label>
            <input list="nameList" id="verifiedBy">
        </div>

        <div class="btn-group">
            <button onclick="generate()">Generate Program</button>
            <button onclick="shareWhatsApp()" style="background-color: #25d366; color: white;">Send to WhatsApp</button>
            <button onclick="sendToDocs()" style="background-color: #4285f4; color: white;">Send to Google Docs</button>
        </div>

        <pre id="output"></pre>
    </div> <!-- End container -->

    <script>
        document.getElementById("date").valueAsDate = new Date();

        function v(id) {
            const el = document.getElementById(id);
            return el ? el.value.trim() : "";
        }
        function csv(id) {
            return v(id).split(/\n+/).map(s => s.trim()).filter(Boolean).join(", ");
        }

        function addBayahEntry(containerId, isSayyidath = false) {
            const container = document.getElementById(containerId);
            const div = document.createElement("div");
            div.className = "bayah-entry";
            div.style.cssText = "margin-bottom: 15px; padding: 10px; background: #f9f9f9; border: 1px solid #ddd; position: relative;";

            const nameClass = isSayyidath ? "bayahSName" : "bayahName";
            const murshidClass = isSayyidath ? "bayahSMurshid" : "bayahMurshid";
            const nameLabel = isSayyidath ? "സയ്യിദാത്ത് പേര് (ഐച്ഛികം)" : "പേര്";
            const murshidLabel = isSayyidath ? "സയ്യിദാത്ത് മുർഷിദ് (ഐച്ഛികം)" : "മുർഷിദ്";

            div.innerHTML = `
                <button type="button" onclick="this.parentElement.remove()" style="position: absolute; right: 10px; top: 10px; background: #ff4444; color: white; border: none; padding: 5px 10px; cursor: pointer;">X</button>
                <label>${nameLabel}</label>
                <input class="${nameClass}">
                
                <label>${murshidLabel}</label>
                <input list="nameList" class="${murshidClass}">
            `;
            container.appendChild(div);
        }

        // Toggle Madad visibility based on Hadra Type
        document.querySelectorAll('input[name="hadraType"]').forEach(radio => {
            radio.addEventListener('change', function () {
                const madadSection = document.getElementById('madadSection');
                if (this.value === 'short') {
                    madadSection.style.display = 'none';
                    document.getElementById('madad').value = ''; // clear value
                } else {
                    madadSection.style.display = 'block';
                }
            });
        });

        function generate() {
            let men = +v("men") || 0, say = +v("sayyidath") || 0, kid = +v("children") || 0;
            let total = men + say + kid;

            let o =
                `Date : ${v("date")}
ദാറുൽ കിറാം കാഞ്ഞങ്ങാട്
******

`;

            if (v("maghrib")) o += `صلاة المغرب\nഇമാം: ${v("maghrib")}\n\n********\n\n`;
            if (v("family")) o += `الواجب العائلى\n\nനേതൃത്വം: ${v("family")}\n\n`;

            if (v("surahPage") || v("ayah")) {
                o += `ختم القرآن\n\n    പേജ് നമ്പർ : ${v("surahPage")}\n    ആയത് നമ്പർ : ${v("ayah")}\n\n`;
                o += `ختم القصائد\n      പേജ് നമ്പർ : ${v("qPage")}\n      ബൈത് നമ്പർ : ${v("baith")}\n\n*******\n\n`;
            }

            if (v("dars")) {
                o += `● ദർസ്\n\n${v("dars")}\n${v("darsRef") ? "അവലംബം: " + v("darsRef") : ""}\n\n********\n\n`;
            }

            if (v("muraqaba")) {
                o += `മുറാഖബ\nനേതൃത്വം: ${v("muraqaba")}\n\n********\n\n`;
            }

            if (v("mustafthih")) {
                let hadraType = document.querySelector('input[name="hadraType"]:checked').value;

                if (hadraType === "full") {
                    o += `ഹള്റ\n\nമുസ്തഫ്തിഹ് : ${v("mustafthih")}\n\n`;
                    o += `ബുസ്ത് 1 : ${v("bust1Main")} (Main)\n\n${csv("bust1List")}\n\n`;
                    if (v("madad")) o += `മദദ്: ${v("madad")}\n\n`;
                    if (v("q1")) o += `ഖസീദ 1 : ${v("q1")}\n`;
                    if (v("q2")) o += `ഖസീദ 2 : ${v("q2")}\n\n`;
                    if (v("fardani")) o += `ഫർദാനി 1 : ${v("fardani")}\n\n`;
                    o += `ബുസ്ത് 2 : ${v("bust2Main")} (Main)\n\n${csv("bust2List")}\n\n`;
                    if (v("q3")) o += `Qaseeda 3 : ${v("q3")}\n`;
                    if (v("q4")) o += `Qaseeda 4 : ${v("q4")}\n\n`;
                    if (v("dua")) o += `Fawatih 2 & Dua\n${v("dua")}\n\n`;
                    o += `*******\n\n`;
                } else if (hadraType === "short") {
                    o += `മുസ്തഫ്തിഹ് :  ${v("mustafthih")}\n\n`;
                    o += `സാഹിബുൽ ബുസ്ത് 1 : ${v("bust1Main")}\n`;

                    // Numbering the bust list items for short format
                    let b1List = v("bust1List").split(/\n+/).map(s => s.trim()).filter(Boolean);
                    if (b1List.length > 0) {
                        b1List.forEach((name, i) => { o += `${i + 1}. ${name}\n`; });
                    }
                    o += `\n`;

                    if (v("q1")) o += `ഖസീദ 1 : ${v("q1")}\n`;
                    if (v("q2")) o += `ഖസീദ 2 : ${v("q2")}\n\n`;

                    o += `സാഹിബുൽ ബുസ്ത് 2 : ${v("bust2Main")} (Main)\n\n`;

                    let b2List = v("bust2List").split(/\n+/).map(s => s.trim()).filter(Boolean);
                    if (b2List.length > 0) {
                        b2List.forEach((name, i) => { o += `${i + 1}. ${name}\n`; });
                    }
                    o += `\n******\n\n`;

                    if (v("fardani")) o += `Fardani:  ${v("fardani")}\n\n`;
                    if (v("q3")) o += `Qaseeda 3:  ${v("q3")}\n`;
                    if (v("q4")) o += `Qaseeda 4 :  ${v("q4")}\n\n`;

                    if (v("dua")) o += `Fawatih 2 & Dua \n${v("dua")}\n\n`;
                    o += `*******\n\n`;
                }
            }

            if (v("munshideen")) o += `മുൻഷിദീങ്ങൾ :\n${csv("munshideen")}\n\n********\n\n`;

            if (v("isha")) o += `الصلاة العشاء\nഇമാം: ${v("isha")}\n\n`;
            if (v("tarawih")) o += `الصلاة تراويح\nഇമാം:\n${csv("tarawih")}\n\n********\n\n`;

            if (v("umana")) o += `*******\nപങ്കെടുത്ത മജ്ലിസുൽ ഉമന അംഗങ്ങൾ\n${csv("umana")}\n\n`;

            if (v("nafah")) o += `● നഫഹ\n\n${csv("nafah")}\n\n********\n\n`;

            // Process Puthiya Bay'ah (Men)
            let bayahMenEntries = [];
            document.querySelectorAll("#bayahContainer .bayah-entry").forEach(entry => {
                let name = entry.querySelector(".bayahName").value.trim();
                let murshid = entry.querySelector(".bayahMurshid").value.trim();
                if (name) bayahMenEntries.push({ name, murshid });
            });

            // Process Puthiya Bay'ah (Sayyidath)
            let bayahSayyidathEntries = [];
            document.querySelectorAll("#bayahSContainer .bayah-entry").forEach(entry => {
                let sName = entry.querySelector(".bayahSName").value.trim();
                let sMurshid = entry.querySelector(".bayahSMurshid").value.trim();
                if (sName) bayahSayyidathEntries.push({ name: sName, murshid: sMurshid });
            });

            if (bayahMenEntries.length > 0 || bayahSayyidathEntries.length > 0) {
                o += `പുതിയ ബൈഅത്ത്\n\n`;

                if (bayahMenEntries.length > 0) {
                    o += `റിജാൽ\n\n`;
                    bayahMenEntries.forEach(entry => {
                        o += `പേര്: ${entry.name}\nമുർഷിദ്: ${entry.murshid}\n\n`;
                    });
                }

                if (bayahSayyidathEntries.length > 0) {
                    o += `സയ്യിദാത്ത്\n\n`;
                    bayahSayyidathEntries.forEach(entry => {
                        o += `പേര്: ${entry.name}\nമുർഷിദ്: ${entry.murshid}\n\n`;
                    });
                }

                o += `*******\n\n`;
            }

            if (men || say || kid) {
                o += `പങ്കെടുത്തവർ\n\nപുരുഷന്മാർ  : ${men}\nസയ്യിദാത്ത്  : ${say}\nകുട്ടികൾ      : ${kid}\n\n  ആകെ=   ${total}\n\n`;
            }

            if (v("preparedBy")) o += `Report prepared by : ${v("preparedBy")}\n\n`;
            if (v("verifiedBy")) o += `Report verified by : ${v("verifiedBy")}\n`;

            document.getElementById("output").textContent = o;
        }

        function shareWhatsApp() {
            const t = document.getElementById("output").textContent;
            if (!t) { alert("Please generate the program first"); return; }
            window.open("https://wa.me/?text=" + encodeURIComponent(t), "_blank");
        }

        async function sendToDocs() {
            const t = document.getElementById("output").textContent;
            if (!t) {
                alert("Please generate the program first");
                return;
            }

            // This is the URL of your deployed Google Apps Script Web App
            const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwqadY-LIsI7PhWxN6JleXwPcWGiLApeM5LFCgseKPmUBODd4jxfw2GkPW1mDx_-b-6tg/exec";

            const btn = document.querySelector('button[onclick="sendToDocs()"]');
            const originalText = btn.textContent;
            btn.textContent = "Sending...";
            btn.disabled = true;

            try {
                // Using mode: 'no-cors' prevents CORS preflight issues when sending a simple form post to Apps Script.
                await fetch(WEB_APP_URL, {
                    method: "POST",
                    mode: "no-cors",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                    },
                    body: "text=" + encodeURIComponent(t)
                });

                alert("Successfully sent to Google Docs!");
            } catch (err) {
                alert("Error sending to Docs: " + err.message);
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }

        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("service-worker.js");
        }
    </script>


</body>

</html>
